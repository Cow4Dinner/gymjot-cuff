syntax = "proto3";

package com.gymjot.cuff;

option java_multiple_files = true;
option java_package = "com.gymjot.cuff";
option csharp_namespace = "Com.Gymjot.Cuff";
option optimize_for = LITE_RUNTIME;

message MetadataEntry {
  string key = 1;
  string value = 2;
}

message StationMetadata {
  repeated MetadataEntry entries = 1;
}

enum DeviceMode {
  DEVICE_MODE_IDLE = 0;
  DEVICE_MODE_AWAITING_STATION = 1;
  DEVICE_MODE_SCANNING = 2;
  DEVICE_MODE_LOITER = 3;
}

message DeviceCommand {
  uint64 timestamp_ms = 1;
  oneof command {
    SetTestModeCommand set_test_mode = 10;
    SetTargetFpsCommand set_target_fps = 11;
    StationUpdateCommand station_update = 12;
    ResetRepsCommand reset_reps = 13;
  }
}

message SetTestModeCommand {
  bool enabled = 1;
}

message SetTargetFpsCommand {
  float fps = 1;
}

message StationUpdateCommand {
  uint32 station_id = 1;
  string name = 2;
  StationMetadata metadata = 3;
  bool set_min_travel_cm = 4;
  float min_travel_cm = 5;
  bool set_fps = 6;
  float fps = 7;
}

message ResetRepsCommand {}

message DeviceEvent {
  uint64 timestamp_ms = 1;
  oneof event {
    BootEvent boot = 10;
    StatusEvent status = 11;
    TagEvent tag = 12;
    StationRequestEvent station_request = 13;
    StationBroadcastEvent station_broadcast = 14;
    ScanEvent scan = 15;
    RepEvent rep = 16;
    StationReadyEvent station_ready = 17;
  }
}

message BootEvent {
  bool test_mode = 1;
  DeviceMode mode = 2;
  float fps = 3;
}

message StatusEvent {
  string status_label = 1;
  DeviceMode mode = 2;
  float fps = 3;
  bool test_mode = 4;
}

message TagEvent {
  uint32 tag_id = 1;
  bool from_test_mode = 2;
}

message StationRequestEvent {
  uint32 tag_id = 1;
}

message StationBroadcastEvent {
  uint32 station_id = 1;
  string name = 2;
  StationMetadata metadata = 3;
  bool from_test_mode = 4;
}

message StationReadyEvent {
  uint32 station_id = 1;
}

message ScanEvent {
  uint32 tag_id = 1;
  float distance_cm = 2;
  DeviceMode mode = 3;
  float fps = 4;
  bool has_station_name = 5;
  string station_name = 6;
}

message RepEvent {
  uint32 tag_id = 1;
  uint32 rep_count = 2;
  bool has_station_name = 3;
  string station_name = 4;
}
